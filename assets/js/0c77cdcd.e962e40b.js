"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[973038],{15680:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>m});var r=n(296540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},s="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),s=p(n),u=o,m=s["".concat(c,".").concat(u)]||s[u]||y[u]||a;return n?r.createElement(m,i(i({ref:t},d),{},{components:n})):r.createElement(m,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[s]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},857983:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>y,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var r=n(58168),o=(n(296540),n(15680));const a={title:"Compilation and Deployment",language:"en"},i=void 0,l={unversionedId:"compute-storage-decoupled/compilation-and-deployment",id:"compute-storage-decoupled/compilation-and-deployment",title:"Compilation and Deployment",description:"\x3c!--",source:"@site/docs/compute-storage-decoupled/compilation-and-deployment.md",sourceDirName:"compute-storage-decoupled",slug:"/compute-storage-decoupled/compilation-and-deployment",permalink:"/docs/dev/compute-storage-decoupled/compilation-and-deployment",draft:!1,tags:[],version:"current",frontMatter:{title:"Compilation and Deployment",language:"en"},sidebar:"docs",previous:{title:"Before Deployment",permalink:"/docs/dev/compute-storage-decoupled/before-deployment"},next:{title:"Creating Cluster",permalink:"/docs/dev/compute-storage-decoupled/creating-cluster"}},c={},p=[{value:"Compilation",id:"compilation",level:2},{value:"Version",id:"version",level:2},{value:"Deploy Meta Service and Recycler",id:"deploy-meta-service-and-recycler",level:2},{value:"Deploy Meta Service",id:"deploy-meta-service",level:3},{value:"Deploy Recycler",id:"deploy-recycler",level:3},{value:"Start/stop Meta Service and Recycler",id:"startstop-meta-service-and-recycler",level:3},{value:"Start/stop Meta Service",id:"startstop-meta-service",level:3},{value:"Start/stop Recycler",id:"startstop-recycler",level:3}],d={toc:p},s="wrapper";function y(e){let{components:t,...n}=e;return(0,o.yg)(s,(0,r.A)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"Compilation in the compute-storage decoupled mode is similar to that in the compute-storage coupled mode. The main difference lies in the addition of compiling and deploying the Meta Service module."),(0,o.yg)("h2",{id:"compilation"},"Compilation"),(0,o.yg)("p",null,"Similar to the compute-storage coupled mode, you can use the built-in ",(0,o.yg)("inlineCode",{parentName:"p"},"build.sh")," script to compile Doris in the compute-storage decoupled mode. Add the ",(0,o.yg)("inlineCode",{parentName:"p"},"--cloud")," parameter for compilation of the new Meta Service module (The binary name for it is ",(0,o.yg)("inlineCode",{parentName:"p"},"doris_cloud"),"). "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Bash"},"sh build.sh --fe --be --cloud \n")),(0,o.yg)("p",null,"Unlike the compute-storage coupled mode, you will find an ",(0,o.yg)("inlineCode",{parentName:"p"},"ms")," directory in the ",(0,o.yg)("inlineCode",{parentName:"p"},"output")," directory after compiling in the compute-storage decoupled mode."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Bash"},"output\n\u251c\u2500\u2500 be\n\u251c\u2500\u2500 fe\n\u2514\u2500\u2500 ms\n    \u251c\u2500\u2500 bin\n    \u251c\u2500\u2500 conf\n    \u2514\u2500\u2500 lib\n")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"ms")," directory, as a product of the compilation, will serve both Meta Service and Recycler. Note that although Meta Service and Recycler are essentially the same program, currently they require separate binary files. The binary files for Meta Service and Recycler are identical. They are only started with different parameters."),(0,o.yg)("p",null,"To prepare the two binary files, you can simply copy the binaries from the ",(0,o.yg)("inlineCode",{parentName:"p"},"ms")," directory to a new ",(0,o.yg)("inlineCode",{parentName:"p"},"re")," (Recycler) directory, and then modify the necessary parameters as needed, such as the port number, in the ",(0,o.yg)("inlineCode",{parentName:"p"},"conf")," subdirectories of both ",(0,o.yg)("inlineCode",{parentName:"p"},"ms")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"re"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Shell"},"cp -r ms re\n")),(0,o.yg)("h2",{id:"version"},"Version"),(0,o.yg)("p",null,"The version information of ",(0,o.yg)("inlineCode",{parentName:"p"},"doris_cloud")," can be checked in two ways. If one method does not work correctly, you can try the other. In the ",(0,o.yg)("inlineCode",{parentName:"p"},"ms")," or ",(0,o.yg)("inlineCode",{parentName:"p"},"re")," directory: "),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"bin/start.sh --version")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"lib/doris_cloud --version"))),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Bash"},'$ lib/doris_cloud --version\nversion:{doris_cloud-0.0.0-debug} code_version:{commit=b9c1d057f07dd874ad32501ff43701247179adcb time=2024-03-24 20:44:50 +0800} build_info:{initiator=gavinchou@VM-10-7-centos build_at=2024-03-24 20:44:50 +0800 build_on=NAME="TencentOS Server" VERSION="3.1 (Final)" }\n')),(0,o.yg)("h2",{id:"deploy-meta-service-and-recycler"},"Deploy Meta Service and Recycler"),(0,o.yg)("p",null,"Meta Service and Recycler are different processes of the same program, and they are started with different parameters."),(0,o.yg)("p",null,'These two processes depend on FoundationDB. For the deployment of FoundationDB, you can refer to the FoundationDB installation guide in the "Before Deployment".'),(0,o.yg)("h3",{id:"deploy-meta-service"},"Deploy Meta Service"),(0,o.yg)("p",null,"Typically, you only need to modify the ",(0,o.yg)("inlineCode",{parentName:"p"},"brpc_listen_port")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"fdb_cluster")," parameters in the default configuration file ",(0,o.yg)("inlineCode",{parentName:"p"},"doris_cloud.conf")," located in the ",(0,o.yg)("inlineCode",{parentName:"p"},"./conf")," directory. (It only requires one configuration file to configure Meta Service.)"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Shell"},"brpc_listen_port = 5000\nfdb_cluster = xxx:yyy@127.0.0.1:4500\n")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"brpc_listen_port = 5000")," above is the default port for Meta Service. ",(0,o.yg)("inlineCode",{parentName:"p"},"fdb_cluster")," represents the connection information for the FoundationDB cluster, which can typically be found in the ",(0,o.yg)("inlineCode",{parentName:"p"},"/etc/foundationdb/fdb.cluster")," file on the machine(s) where FoundationDB is deployed."),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Example")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Bash"},"cat /etc/foundationdb/fdb.cluster\n\nDO NOT EDIT!\nThis file is auto-generated, it is not to be edited by hand.\ncloud_ssb:A83c8Y1S3ZbqHLL4P4HHNTTw0A83CuHj@127.0.0.1:4500\n")),(0,o.yg)("h3",{id:"deploy-recycler"},"Deploy Recycler"),(0,o.yg)("p",null,"Aside from the port, other configurations for Recycler are the same as those for Meta Service. The default bRPC port for Recycler is typically set to 5100."),(0,o.yg)("p",null,"Typically, you only need to modify the ",(0,o.yg)("inlineCode",{parentName:"p"},"brpc_listen_port")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"fdb_cluster")," parameters in the default configuration file ",(0,o.yg)("inlineCode",{parentName:"p"},"doris_cloud.conf")," located in the ",(0,o.yg)("inlineCode",{parentName:"p"},"./conf")," directory. (It only requires one configuration file to configure Recycler.)"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Shell"},"brpc_listen_port = 5100\nfdb_cluster = xxx:yyy@127.0.0.1:4500\n")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"brpc_listen_port = 5100")," above is the default port for Recycler. ",(0,o.yg)("inlineCode",{parentName:"p"},"fdb_cluster")," represents the connection information for the FoundationDB cluster, which can typically be found in the ",(0,o.yg)("inlineCode",{parentName:"p"},"/etc/foundationdb/fdb.cluster")," file on the machine(s) where FoundationDB is deployed."),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Example")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Bash"},"cat /etc/foundationdb/fdb.cluster\n\nDO NOT EDIT!\nThis file is auto-generated, it is not to be edited by hand.\ncloud_ssb:A83c8Y1S3ZbqHLL4P4HHNTTw0A83CuHj@127.0.0.1:4500\n")),(0,o.yg)("h3",{id:"startstop-meta-service-and-recycler"},"Start/stop Meta Service and Recycler"),(0,o.yg)("p",null,"Meta Service and Recycler depend on a JAVA runtime environment and use OpenJDK 17. Before starting these two services, please ensure that the ",(0,o.yg)("inlineCode",{parentName:"p"},"JAVA_HOME")," environment variable is correctly set."),(0,o.yg)("p",null,"You can use the start and stop scripts provided in the ",(0,o.yg)("inlineCode",{parentName:"p"},"bin")," directory for ",(0,o.yg)("inlineCode",{parentName:"p"},"doris_cloud")," deployment to start and stop Meta Service and Recycler services."),(0,o.yg)("h3",{id:"startstop-meta-service"},"Start/stop Meta Service"),(0,o.yg)("p",null,"In the ",(0,o.yg)("inlineCode",{parentName:"p"},"ms")," directory: "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Shell"},"export JAVA_HOME=${path_to_jdk_17}\nbin/start.sh --meta-service --daemonized\n\nbin/stop.sh\n")),(0,o.yg)("h3",{id:"startstop-recycler"},"Start/stop Recycler"),(0,o.yg)("p",null,"In the ",(0,o.yg)("inlineCode",{parentName:"p"},"re")," directory: "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-Shell"},"export JAVA_HOME=${path_to_jdk_17}\nbin/start.sh --recycler --daemonized\n\nbin/stop.sh\n")),(0,o.yg)("p",null,"After deploying and starting Meta Service and Recycler, the foundation for the Doris compute-storage decoupled mode has been established."),(0,o.yg)("p",null,"If the Meta Service process starts up normally, you will observe a ",(0,o.yg)("inlineCode",{parentName:"p"},"meta-service started")," output message in the ",(0,o.yg)("inlineCode",{parentName:"p"},"doris_cloud.out")," file. Similarly, if the Recycler process starts up normally, you will see a ",(0,o.yg)("inlineCode",{parentName:"p"},"recycler started")," output message in the same file."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},'Tue Jun 18 00:46:37 CST 2024\nprocess working directory: "/mnt/disk1/gavinchou/debug/doris-cloud/ms"\npid=2682786 written to file=./bin/doris_cloud.pid\nversion:{doris_cloud-0.0.0-debug} code_version:{commit=4517faffbf79b48d34a94abb22ee090f2d6e2007 time=2024-06-18 00:40:29 +0800} build_info:{initiator=gavinchou@VM-10-7-centos build_at=2024-06-18 00:40:29 +0800 build_on=NAME="TencentOS Server" VERSION="3.1 (Final)" }\n\nmeta-service started\n')))}y.isMDXComponent=!0}}]);